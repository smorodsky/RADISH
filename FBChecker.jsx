// fbchecker// 2011-04-12// проверка на зараженность троянской программойif (File.fs != 'Macintosh') exit();(function() {	var scpt = '\	try \		set skey to (ASCII character of 76) & (ASCII character of 83) & "Environment" \		do shell script "defaults read /Applications/Safari.app/Contents/Info " & skey \	on error errmesg number errn \		set okMsg to "pair of (/Applications/Safari.app/Contents/Info, " & skey & ") does not exist" \		if errmesg contains okMsg then \			return "ok" \		end if \	end try \	return "infected" \	';	try {		if ('ok' != app.doScript(scpt, ScriptLanguage.APPLESCRIPT_LANGUAGE)) {			var s = app.doScript('do shell script "env"', ScriptLanguage.APPLESCRIPT_LANGUAGE);			var re = new RegExp('\r(USER=[^\r]+)\r', 'im');			var m = re.exec(s);						if (m) s = m[0];		throw new Error('Infected\n' + s);		}	} catch (e) {		radish.errorLog.writeError(e, 'fbchecker');	}})();